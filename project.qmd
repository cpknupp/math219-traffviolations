---
title: "My Document"
format:
  pdf
---

# Packages

```{R}
#install.packages('rmarkdown')
#install.packages('readxl') #-- Used for importing xlsx spreadsheets.
#install.packages('tidyverse')
library(rmarkdown)
library(readxl)
library(tidyverse)
```

# Importing Table & Sorting Data

```{R}
traff_violations <- read_excel('AttemptTwo.xlsx')
traff_violations

#Description of Violation
most_common_description <- traff_violations %>%
  count(Description) %>%
  arrange(desc(n)) %>%
  slice(1:5)
print(most_common_description)

#Vehicle Year
most_common_vehicle_year <- traff_violations %>%
  count(Year) %>%
  arrange(desc(n)) %>%
  slice(1:10)
print(most_common_vehicle_year)

#Vehicle Make
most_common_vehicle_make <- traff_violations %>%
  count(Make) %>%
  arrange(desc(n)) 
  #%>% slice(1:5)
print(most_common_vehicle_make)

#Vehicle Model
most_common_vehicle_model <- traff_violations %>%
  count(Model) %>%
  arrange(desc(n)) %>%
  slice(1:5)
print(most_common_vehicle_model)

#Race of Driver
most_common_race <- traff_violations %>%
  count(Race) %>%
  arrange(desc(n)) 
  #%>% slice(1:5)
print(most_common_race)

alcohol <- traff_violations %>% count(Alcohol)

ggplot(alcohol, aes(Alcohol, n, fill = Alcohol))+ geom_bar(stat = "identity")


df <- traff_violations %>%
  mutate(
    datetime = as.POSIXct(paste(`Date Of Stop`, `Time Of Stop`), format = "%Y-%m-%d %H:%M:%S"),
    hour = hour(datetime),
    weekday = wday(datetime, label = TRUE, abbr = FALSE)
  ) %>%
  count(weekday, hour)



ggplot(df, aes(x = hour, y = fct_rev(weekday), fill = n)) +
  geom_tile() +
  geom_text(aes(label = n), color = "black", size = 3) +
  scale_fill_gradient(low = "#f0f9e8", high = "#08589e") +
  labs(
    title = "Traffic Stops by Hour and Day of Week",
    x = "Hour of Day",
    y = "Day of Week",
    fill = "Number of Stops"
  ) +
  theme_minimal()
```
